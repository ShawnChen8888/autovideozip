# 部署检查清单

## 部署前必须完成的配置

### 1. 更新域名配置
- [ ] 在 `api/main.py` 中更新 `ALLOWED_ORIGINS` 列表，将 `"https://yourdomain.vercel.app"` 替换为你的实际域名
- [ ] 如果有自定义域名，添加到 CORS 配置中

### 2. 环境变量设置（可选）
- [ ] 如需自定义文件大小限制，设置 `FILE_SIZE_LIMIT` 环境变量
- [ ] 如需调整并发任务数，设置 `MAX_CONCURRENT_TASKS` 环境变量

### 3. Vercel 配置验证
- [ ] 确认 `vercel.json` 配置正确
- [ ] 检查函数内存和超时时间设置
- [ ] 验证安全头配置

## 部署步骤

### 1. 代码准备
```bash
# 确保所有文件都在正确位置
git add .
git commit -m "优化生产环境配置"
git push origin main
```

### 2. Vercel 部署
1. 访问 [vercel.com](https://vercel.com)
2. 连接你的 GitHub 仓库
3. 选择项目并点击部署
4. 等待部署完成

### 3. 部署后验证
- [ ] 访问部署的 URL，确认页面正常加载
- [ ] 测试文件上传功能
- [ ] 检查压缩功能是否正常工作
- [ ] 验证错误处理是否正确显示
- [ ] 访问 `/health` 端点检查服务状态

## 监控和维护

### 日志监控
- 在 Vercel 控制台查看函数日志
- 监控错误率和响应时间
- 关注文件处理成功率

### 性能监控
- 监控并发任务数量
- 检查临时文件清理情况
- 观察内存使用情况

### 定期维护
- 定期检查日志中的错误模式
- 根据使用情况调整资源配置
- 更新依赖包到最新版本

## 故障排除

### 常见问题
1. **FFmpeg 不可用**
   - 检查 Vercel 的 Python 运行时是否支持 FFmpeg
   - 考虑使用第三方 API 服务

2. **文件处理超时**
   - 检查文件大小是否超过限制
   - 优化压缩参数
   - 考虑增加函数超时时间

3. **CORS 错误**
   - 确认域名配置正确
   - 检查请求来源是否在允许列表中

4. **内存不足**
   - 检查并发任务数设置
   - 考虑增加函数内存限制
   - 优化文件处理流程

## 安全建议

- 定期更新依赖包
- 监控异常访问模式
- 考虑添加访问频率限制
- 定期备份重要配置文件